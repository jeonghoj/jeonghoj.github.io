---
layout: post
title: "2-1. https"
date: 2017-10-05 12:07
categories: web_study
---
## HTTPS

https 인증 프로토콜을 적용하기 앞서 https에 대해서 알아보도록 하자

https란 http + ssl/tls를 결합한 용어로써 http통신에서 일반 텍스트를 사용하는 대신에 ssl/tls 프로토콜을 통해 데이터를 암호화하여 통신한다.

## TLS

TLS는 SSL3.0을 계승한 프로토콜로서 현시점에서 1.2 버전까지 나왔다. 보통 SSL/TLS로 병행 표기하는 경우가 많다.

![3hanshake](https://www.ibm.com/support/knowledgecenter/SSFKSJ_7.1.0/com.ibm.mq.doc/sy10660a.gif)

TLS는 요약하자면 3번의 절차를 거쳐 통신을 암호화한다.

1. 지원 가능한 암호화 알고리즘 교환
1. 키 교환, 인증
1. 대칭키 암호로 암호화 하고 메시지 인증

이를 3 handshake라고 한다.

## 전자서명

이렇게 통신을 암호화하는데, 이 통신을 어떻게 신뢰할 수 있을까?

### CA로부터 인증서를 발급

통신을 하기 전, 서버는 CA(Certificate Authority)에 인증서를 요청하기 위해 자신의 공개키를 CA에 보낸다.

CA는 A의 공개키로 CA의 개인키를 암호화 하여 서버에 보내주고 서버는 이 키를 저장한다. 이 키가 서버에서 사용하는 인증서이다.

## 서버와 사용자간 암호 통신

### 통신 방식

서버와 사용자는 메세지를 대칭키로 암호화 하여 통신을 한다. 비대칭키 암호화 알고리즘으로 통신 할수도 있지만, 속도가 느려 적합하지 않다.

때문에 메세지를 대칭키로 암호화하고, 복호화키를 비대칭키 방식으로 사용자에게 전달하여, 서버와 사용자간 암호 통신을 한다.

### 비대칭키 통신 절차

먼저 사용자가 서버에 접속을 요청한다. 이때 브라우저는 서버의 인증서를 서명해준 CA가 자신이 가지고 있는 CA 목록에 있는지 확인한다. CA목록에 있다면 그 CA의 공개키를 가지고 인증서를 복호화 한다. 만약 복호화가 된다면 그 인증서는 CA에서 발급된 유효한 인증서 이므로, 이 서버를 신뢰할 수 있다고 결론짓는다.

## 정리

지금까지 설명한 사용자와 서버간의 암호 통신에 대해서 정리하겠다.

1. 서버가 서버의 공개키로 CA에 인증서를 요청한다.
1. CA는 CA의 개인키로 서버의 공개키를 암호화하여 서버에 전송하고, 서버는 이 키를 저장한다.
1. 사용자는 서버에 접속할 때 서버의 인증서가 유효한지 검사한다.
1. 인증서가 유효하다면 대칭키로 통신하기 위해 복호화 키를 서버의 공개키로 암호화 하여 서버에 전달한다.
1. 이 후 통신은 대칭키 암호화 알고리즘 방식으로 진행한다.